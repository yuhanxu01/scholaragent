# 全局选择工具栏测试指南

## 🎯 新功能说明

现在选择任何文本后都会显示一个工具栏，提供以下选项：

1. **📘 词典** - 查看单词释义、翻译、例句
2. **💬 提问** - 向AI询问选中文本（功能待完善）
3. **📋 复制** - 复制选中的文本到剪贴板
4. **❌ 关闭** - 关闭工具栏

## 🧪 测试方法

### 基本测试
1. 访问 http://localhost:5173
2. 登录后进入任意页面
3. 选择任何文本（英文或中文）
4. 应该在选择文本附近出现工具栏
5. 点击不同按钮测试功能

### 具体测试步骤

#### 1. 选择文本
- 在任何页面选择一段文本
- 可以选择单词、短语或句子
- 选择后工具栏会在100ms后自动出现

#### 2. 测试词典功能
- 选择一个英文单词（如 "implementation"）
- 点击工具栏中的词典图标（📘）
- 应该弹出查词窗口显示释义、翻译等
- 在查词窗口中可以继续双击查词

#### 3. 测试复制功能
- 选择任何文本
- 点击复制图标（📋）
- 文本应该复制到剪贴板
- 按钮提示会短暂显示"已复制！"

#### 4. 测试AI提问功能
- 选择文本
- 点击提问图标（💬）
- 目前会在控制台打印日志（功能待完善）

#### 5. 测试关闭功能
- 点击关闭图标（❌）关闭工具栏
- 或点击页面其他地方自动关闭

## 🔍 预期行为

### ✅ 正常工作
- 选择任何文本都会显示工具栏
- 工具栏位置合理，不会超出屏幕边界
- 点击按钮有相应功能
- 工具栏不会与页面其他元素冲突

### ❌ 不会触发的情况
- 在输入框、按钮、选择框等交互元素中选择文本
- 选择空文本
- 在工具栏或查词弹窗内部选择文本

## 🐛 可能的问题及解决方案

### 问题1：工具栏不显示
- 检查是否真的选择了文本（文本高亮）
- 等待100ms让工具栏出现
- 检查控制台是否有错误

### 问题2：工具栏位置不正确
- 工具栏会自动调整位置避免超出屏幕
- 如果位置仍然不理想，可能需要调整算法

### 问题3：复制功能不工作
- 浏览器可能阻止剪贴板访问
- 检查浏览器权限设置

## 📝 后续优化

1. **AI提问功能完善** - 集成到现有的AI聊天系统
2. **更多操作选项** - 添加笔记、收藏等功能
3. **样式优化** - 改善工具栏的视觉效果
4. **键盘快捷键** - 添加键盘操作支持

## 🔧 开发者信息

- 主要文件：
  - `src/hooks/useGlobalDictionary.tsx` - 核心逻辑
  - `src/components/dictionary/GlobalSelectionToolbar.tsx` - 工具栏组件
  - `src/components/dictionary/GlobalDictionaryProvider.tsx` - 提供者组件

- 技术实现：
  - 监听 `selectionchange` 事件
  - 使用 `getBoundingClientRect()` 获取选择位置
  - 延迟100ms显示工具栏避免干扰选择操作