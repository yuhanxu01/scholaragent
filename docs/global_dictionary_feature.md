# 全局双击查词功能说明

## 功能概述

全局双击查词功能允许用户在应用的任何地方双击英文单词来查看释义、翻译和例句。该功能还会在查词结果中支持连续查词。

## 功能特点

### 1. 全局触发
- 在应用的任何页面都可以双击查词
- 支持双击选中单个单词或自动识别点击位置的单词
- 最小单词长度为2个字符

### 2. 智能识别
- 优先使用用户选中的文本
- 支持连字符单词（如 state-of-the-art）
- 过滤纯数字和过短的单词
- 自动获取上下文信息

### 3. 查词结果界面支持连续查词
- 在释义文本中双击单词可继续查词
- 在翻译文本中双击单词可继续查词
- 在例句中双击单词可继续查词
- 在上下文中双击单词可继续查词

### 4. 交互优化
- 查词窗口显示在鼠标双击位置附近
- 自动防止超出屏幕边界
- 点击外部区域或按ESC键关闭窗口
- 在输入框、按钮等交互元素上不会触发查词
- 避免在查词窗口内部触发新的查词

## 使用方法

### 基本使用
1. 在任意页面找到想要查询的英文单词
2. 双击该单词
3. 查词窗口会自动弹出，显示单词的释义、翻译、例句等信息
4. 可以点击播放按钮听取发音
5. 可以点击"保存到生词本"将单词添加到个人词汇库

### 连续查词
1. 在查词结果窗口中
2. 双击释义、翻译、例句或上下文中的任何英文单词
3. 查词窗口会更新显示新单词的信息

### 关闭查词窗口
- 点击查词窗口外的任意位置
- 按ESC键
- 点击查词窗口的关闭按钮

## 技术实现

### 核心文件
- `src/hooks/useGlobalDictionary.ts` - 全局查词功能的Hook
- `src/components/dictionary/GlobalDictionaryProvider.tsx` - 全局字典提供者组件
- `src/components/dictionary/DictionaryPopup.tsx` - 查词弹窗组件（已增强）
- `src/App.tsx` - 应用入口（已集成全局字典功能）

### 样式文件
- `src/styles/dictionary.css` - 查词功能相关样式

### 关键特性
1. **智能文本选择**: 优先使用用户选中文本，否则自动识别点击位置的单词
2. **上下文感知**: 自动获取单词所在段落的上下文，便于理解和记忆
3. **边界检测**: 防止查词窗口超出屏幕边界
4. **性能优化**: 使用防抖和缓存机制优化性能

## 注意事项

### 不触发查词的情况
1. 双击输入框、按钮等交互元素
2. 双击长度小于2个字符的单词
3. 双击纯数字
4. 在查词窗口内部双击（避免循环触发）
5. 双击带有 `.no-dictionary` 类的元素

### 浏览器兼容性
- 支持所有现代浏览器
- 使用 `document.caretRangeFromPoint` API，IE不支持
- 使用 Web Speech API 播放发音

### 性能考虑
- 查词窗口使用懒加载，只在需要时显示
- 合理使用缓存避免重复请求
- 优化事件监听器的添加和移除

## 未来优化方向

1. **离线支持**: 集成本地词典，支持离线查词
2. **多语言支持**: 支持查词其他语言的单词
3. **键盘快捷键**: 添加键盘快捷键触发查词
4. **历史记录**: 记录查词历史，方便回顾
5. **自定义样式**: 允许用户自定义查词窗口样式